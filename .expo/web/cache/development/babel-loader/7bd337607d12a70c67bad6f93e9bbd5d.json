{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { makeAutoObservable } from \"mobx\";\nimport decode from \"jwt-decode\";\nimport { instance } from \"../store/instance\";\nimport React from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nvar AuthStore = function AuthStore() {\n  var _this = this;\n\n  _classCallCheck(this, AuthStore);\n\n  this.user = null;\n\n  this.checkForToken = function _callee() {\n    var token, currentTime, tempUser;\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _this.user = null;\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"myToken\"));\n\n          case 4:\n            token = _context.sent;\n\n            if (token) {\n              currentTime = Date.now();\n              tempUser = decode(token);\n\n              if (tempUser.exp >= currentTime) {\n                _this.setUser(token);\n              } else {\n                _this.signOut();\n              }\n            }\n\n            _context.next = 10;\n            break;\n\n          case 8:\n            _context.prev = 8;\n            _context.t0 = _context[\"catch\"](0);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.setUser = function _callee2(token) {\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"myToken\", token));\n\n          case 3:\n            _this.user = decode(token);\n            instance.defaults.headers.common.Authorization = \"Bearer \" + token;\n            _context2.next = 9;\n            break;\n\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2[\"catch\"](0);\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.signup = function _callee3(userData, navigation, toast) {\n    var response;\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signup\", userData));\n\n          case 3:\n            response = _context3.sent;\n\n            _this.setUser(response.data.token);\n\n            _context3.next = 10;\n            break;\n\n          case 7:\n            _context3.prev = 7;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.log(_context3.t0);\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.signOut = function _callee4() {\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            delete instance.defaults.headers.common.Authorization;\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"myToken\"));\n\n          case 4:\n            _this.user = null;\n            _context4.next = 9;\n            break;\n\n          case 7:\n            _context4.prev = 7;\n            _context4.t0 = _context4[\"catch\"](0);\n\n          case 9:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.signin = function _callee5(user, navigation, toast) {\n    var response;\n    return _regeneratorRuntime.async(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            _context5.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signin\", user));\n\n          case 3:\n            response = _context5.sent;\n\n            _this.setUser(response.data.token);\n\n            if (!_this.user) {\n              toast.show({\n                title: \"Invalid login\",\n                status: \"error\",\n                description: \"wrong username/password combination\"\n              });\n            }\n\n            _context5.next = 11;\n            break;\n\n          case 8:\n            _context5.prev = 8;\n            _context5.t0 = _context5[\"catch\"](0);\n            console.log(\"AuthStore -> signin -> error\", _context5.t0);\n\n          case 11:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  makeAutoObservable(this);\n};\n\nvar authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;","map":{"version":3,"sources":["/Users/abdullahalkhaldi/Development/Traveldiary-ProjectFE-Final/store/authStore.js"],"names":["makeAutoObservable","decode","instance","React","AsyncStorage","AuthStore","user","checkForToken","getItem","token","currentTime","Date","now","tempUser","exp","setUser","signOut","setItem","defaults","headers","common","Authorization","signup","userData","navigation","toast","post","response","data","console","log","removeItem","signin","show","title","status","description","authStore"],"mappings":"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","sourcesContent":["import { makeAutoObservable } from \"mobx\";\nimport decode from \"jwt-decode\";\nimport { instance } from \"../store/instance\";\nimport React from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nclass AuthStore {\n  user = null;\n  constructor() {\n    makeAutoObservable(this);\n  }\n\n  checkForToken = async () => {\n    try {\n      this.user = null\n      const token = await AsyncStorage.getItem(\"myToken\");\n      if (token) {\n        const currentTime = Date.now(); // give us the current time\n        let tempUser = decode(token);\n        if (tempUser.exp >= currentTime) {\n          this.setUser(token);\n        } else {\n          this.signOut();\n        }\n      }\n    } catch (error) {}\n  };\n\n  setUser = async (token) => {\n    try {\n      await AsyncStorage.setItem(\"myToken\", token);\n      this.user = decode(token);\n      //   console.log(this.user);\n      instance.defaults.headers.common.Authorization = `Bearer ${token}`;\n    } catch (error) {}\n  };\n  signup = async (userData, navigation, toast) => {\n    try {\n      const response = await instance.post(\"/signup\", userData);\n      this.setUser(response.data.token);\n      //   navigation.replace(\"Home\");\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  signOut = async () => {\n    try {\n      delete instance.defaults.headers.common.Authorization;\n      await AsyncStorage.removeItem(\"myToken\");\n      this.user = null;\n    } catch (error) {}\n  };\n\n  signin = async (user, navigation, toast) => {\n    try {\n        \n      const response = await instance.post(\"/signin\", user);\n      this.setUser(response.data.token);\n      if (! this.user) {\n        toast.show({\n          title: \"Invalid login\",\n          status: \"error\",\n          description: \"wrong username/password combination\",\n        });\n      }\n      // navigation.replace(\"Home\");\n    } catch (error) {\n      console.log(\"AuthStore -> signin -> error\", error);\n    }\n  \n  };\n}\n\nconst authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;\n"]},"metadata":{},"sourceType":"module"}